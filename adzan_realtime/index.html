<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Adzan Realtime</title>

<!-- PWA Meta Tags -->
<meta name="theme-color" content="#00ffff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Adzan Realtime">
<meta name="description" content="Aplikasi jadwal sholat real-time dengan hadith shahih dan reminder sholat sunnah">

<!-- Icons -->
<link rel="icon" href="/_favicon.png" type="image/png">
<link rel="apple-touch-icon" href="/images/_logo.png">
<link rel="manifest" href="/manifest.json">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">AZ</div>
    <div>
      <h1>Adzan Realtime</h1>
      <div class="sub">Jadwal sholat otomatis dan hadist harian</div>
    </div>
  </header>

  <div class="card">
    <div class="row">
      <div>
        <div class="clock" id="nowclock">--:--:--</div>
        <div class="sub" id="nowdate">memuat...</div>
      </div>
      <div style="text-align:right">
        <div class="sub"><i class="fas fa-map-marker-alt"></i> Lokasi</div>
        <div id="locname" class="small loading">mengambil lokasi...</div>
        <div style="margin-top:8px" class="small">Timezone: <span id="tzname">-</span></div>
      </div>
    </div>
  </div>

  <div class="card hadith-ticker">
    <div class="hadith-content" id="hadithContent">
      <i class="fas fa-quote-right"></i>
      <div class="hadith-text-container">
        <div class="hadith-arabic" id="hadithArabic">Loading...</div>
        <div class="hadith-indonesia" id="hadithIndonesia">Memuat hadith...</div>
        <div class="hadith-reference" id="hadithReference">-</div>
      </div>
    </div>
    <div class="hadith-controls">
      <button class="hadith-btn" id="prevHadith" title="Hadist Sebelumnya">
        <i class="fas fa-chevron-left"></i>
      </button>
      <button class="hadith-btn" id="playPauseHadith" title="Pause/Play Auto">
        <i class="fas fa-pause"></i>
      </button>
      <button class="hadith-btn" id="nextHadith" title="Hadist Selanjutnya">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
    <div class="hadith-progress">
      <div class="progress-bar-container">
        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px; margin-bottom: 20px;">
      <div>
        <div class="sub"><i class="fas fa-mosque"></i> Jadwal sholat hari ini</div>
        <div class="small">Metode: <span id="methodName">Kemenag Indonesia</span></div>
      </div>
      <div class="controls">
        <select id="method" title="Pilih metode perhitungan">
          <option value="KEMENAG" selected>Kemenag Indonesia</option>
          <option value="MWL">Muslim World League</option>
          <option value="ISNA">ISNA</option>
          <option value="Egypt">Egypt</option>
          <option value="Makkah">Umm al-Qura / Makkah</option>
          <option value="Karachi">University of Karachi</option>
        </select>
        <div class="city-input-container">
          <input id="cityInput" list="citySuggestions" type="text" placeholder="🔍 Ketik nama kota...">
          <div class="city-loader" id="cityLoader" style="display: none;">
            <div class="loader-spinner"></div>
          </div>
        </div>
        <datalist id="citySuggestions"></datalist>
        <button id="btnCity"><i class="fas fa-city"></i> Gunakan kota</button>
        <button id="btnRefresh"><i class="fas fa-location-arrow"></i> GPS</button>
        <button id="btnNotification" class="notification-btn" title="Aktifkan/Nonaktifkan pengingat sholat">
          <i class="fas fa-bell-slash"></i> <span class="btn-text">Aktifkan Notifikasi</span>
        </button>
      </div>
      
      <!-- PWA Install Banner for Android -->
      <div id="pwaInstallBanner" class="pwa-banner" style="display: none;">
        <div class="pwa-content">
          <i class="fas fa-mobile-alt"></i>
          <div>
            <strong>Install Aplikasi</strong>
            <small>Untuk notifikasi yang lebih andal di Android, install sebagai aplikasi</small>
          </div>
          <button id="btnInstallPWA" class="pwa-install-btn">Install</button>
          <button id="btnCloseBanner" class="pwa-close-btn">×</button>
        </div>
      </div>
    </div>

    <table id="prayTable">
      <thead><tr><th><i class="fas fa-pray"></i> Sholat</th><th><i class="fas fa-clock"></i> Waktu</th><th><i class="fas fa-info-circle"></i> Info</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="card sunnah-section">
    <div class="sub"><i class="fas fa-moon"></i> Sholat Sunnah Saat Ini</div>
    <div class="small" style="margin-bottom: 15px;">Amalan sunnah yang dapat dikerjakan pada waktu ini</div>
    <div id="sunnahPrayersList" class="sunnah-prayers-list">
      <!-- Sunnah prayers will be populated by JavaScript -->
    </div>
  </div>

  <footer>
    <div class="small"><i class="fas fa-database"></i> Sumber: Aladhan API (utama) — fallback: perhitungan lokal dengan PrayTimes.js.</div>
    <div class="copyright">
      <div class="small"><i class="fas fa-copyright"></i> 2025 Muhammad Faris Muzakki & Istri Tercinta (Lulusan Terbaik Imam Muhammad bin Saud University Jurusan Syariah Tahun 2022)</div>
    </div>
  </footer>
</div>

<!-- Custom Modal for alerts -->
<div id="customModal" class="custom-modal">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">Konfirmasi</h3>
      <button class="modal-close" id="modalClose">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="modal-icon">
        <i id="modalIcon" class="fas fa-bell"></i>
      </div>
      <p id="modalMessage">Pesan akan ditampilkan di sini</p>
    </div>
    <div class="modal-actions">
      <button id="modalCancel" class="modal-btn modal-btn-cancel">
        <i class="fas fa-times"></i> Batal
      </button>
      <button id="modalConfirm" class="modal-btn modal-btn-confirm">
        <i class="fas fa-check"></i> Setuju
      </button>
    </div>
  </div>
</div>

<!-- Floating Prayer Widget for Mobile -->
<div id="floatingPrayerWidget" class="floating-prayer-widget" style="display: none;">
  <div class="widget-content">
    <div class="widget-icon">
      <i class="fas fa-mosque"></i>
    </div>
    <div class="widget-info">
      <div class="widget-prayer-name" id="widgetPrayerName">Sholat Berikutnya</div>
      <div class="widget-countdown" id="widgetCountdown">--:--:--</div>
    </div>
    <div class="widget-pulse"></div>
  </div>
</div>

<script src="./hadith.js"></script>
<script src="./sunnah-hadith.js"></script>
<script src="./app.js" defer></script>

<!-- PWA Registration Script -->
<script>
// Register service worker for PWA functionality
if ('serviceWorker' in navigator && window.location.protocol !== 'file:') {
  window.addEventListener('load', () => {
    // Use relative path for better compatibility
    navigator.serviceWorker.register('./sw.js')
      .then(registration => {
        console.log('Adzan Realtime: Service Worker registered successfully:', registration.scope);
      })
      .catch(error => {
        console.log('Adzan Realtime: Service Worker registration failed:', error);
      });
  });
} else {
  console.log('Adzan Realtime: Service Worker not supported or file:// protocol detected');
}
</script>
</body>
</html>